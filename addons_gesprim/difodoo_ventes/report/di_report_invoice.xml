<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<template id="di_report_invoice_document" inherit_id="account.report_invoice_document">
		<!-- ajout entêtes -->
		<xpath expr="//table/thead/tr/th[6]" position="after">
			<th>Unité Prix</th>
		</xpath>
		<xpath expr="//table/thead/tr/th[1]" position="after">
			<th>
				<div>Nb Pièces/</div>
				<div>Catégorie</div>
			</th>
			<th>
				<div>Nb Colis/</div>
				<div>Origine</div>
			</th>
			<th>
				<div>Type Colis/</div>
				<div>Marque</div>
			</th>
			<th>
				<div>Poids Net/</div>
				<div>Calibre</div>
			</th>
		</xpath>
		<!-- ajouts contenu colonnes -->
		<xpath expr="//table/tbody/tr[1]/td[6]" position="after">
			<td>
				<span t-field="l.di_un_prix" />
			</td>
		</xpath>
		<xpath expr="//table/tbody/tr[1]/td[1]" position="after">
			<td>
				<!-- on masque le nb pièces si prix au kg -->
				<t t-if="l.di_un_prix != 'KG'">
					<div t-field="l.di_nb_pieces" />
					<div t-field="l.product_id.product_tmpl_id.di_categorie_id" />
				</t>
				<t t-if="l.di_un_prix == 'KG'">
					<div>&amp;nbsp;</div>
					<div t-field="l.product_id.product_tmpl_id.di_categorie_id" />
				</t>
			</td>
			<td>
				<div t-field="l.di_nb_colis" />
				<div t-field="l.product_id.product_tmpl_id.di_origine_id" />
			</td>
			<td>
				<div t-field="l.di_product_packaging_id" />
				<div t-field="l.product_id.product_tmpl_id.di_marque_id" />
			</td>
			<td>
				<div t-field="l.di_poin" />
				<div t-field="l.product_id.product_tmpl_id.di_calibre_id" />
			</td>
		</xpath>
		<!-- ajout colonnes vide pour ne pas casser affichage du pied -->
		<xpath expr="//table/tbody/tr[2]/td[6]" position="after">
			<td></td>
		</xpath>
		<xpath expr="//table/tbody/tr[2]/td[1]" position="after">
			<td></td>
			<td></td>
			<td></td>
			<td></td>
		</xpath>
	</template>
	
	<template id="di_report_invoice">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-foreach="range(o.di_nbex)" t-as="n">
                    <t t-call="account.report_invoice_document" t-lang="o.partner_id.lang"/>
                </t>
            </t>
        </t>
    </template>
    
    <template id="di_report_invoice_with_payments">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-foreach="range(o.di_nbex)" t-as="n">
                    <t t-call="account.report_invoice_document_with_payments" t-lang="o.partner_id.lang"/>
                </t>
            </t>
        </t>
    </template>
    <template id="di_report_intrastatinvoice">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-foreach="range(o.di_nbex)" t-as="n">
                    <t t-call="report_intrastat.report_intrastatinvoice_document" t-lang="o.partner_id.lang"/>
                </t>                
            </t>
        </t>
    </template>
    <!--  -->
     <report 
            id="account.account_invoices"
            model="account.invoice"
            string="Invoices"
            report_type="qweb-pdf"
            name="difodoo_ventes.di_report_invoice_with_payments"
            file="difodoo_ventes.di_report_invoice_with_payments"
            attachment="(object.state in ('open','paid')) and ('INV'+(object.number or '').replace('/','')+'.pdf')"
            print_report_name="(object._get_printed_report_name())"
        />

        <report
            id="account.account_invoices_without_payment"
            model="account.invoice"
            string="Invoices without Payment"
            report_type="qweb-pdf"
            name="difodoo_ventes.di_report_invoice"
            file="difodoo_ventes.di_report_invoice"
            attachment="(object.state in ('open','paid')) and ('INV'+(object.number or '').replace('/','')+'.pdf')"
            print_report_name="(object._get_printed_report_name())"
        />
        <report 
        id="report_intrastat.account_intrastatinvoices"
        model="account.invoice"
        string="Intrastat Invoices"
        report_type="qweb-pdf"
        name="difodoo_ventes.di_report_intrastatinvoice"
        file="difodoo_ventes.di_report_intrastatinvoice"
        print_report_name="
            (object.type == 'out_invoice' and object.state == 'draft' and 'Intrastat Invoice' or
            object.type == 'out_invoice' and object.state in ('open','paid') and 'Intrastat Invoice - %s' % (object.number) or
            object.type == 'out_refund' and object.state == 'draft' and 'Intrastat Credit Note' or
            object.type == 'out_refund' and 'Intrastat Credit Note - %s' % (object.number) or
            object.type == 'in_invoice' and object.state == 'draft' and 'Intrastat Vendor Bill' or
            object.type == 'in_invoice' and object.state in ('open','paid') and 'Intrastat Vendor Bill - %s' % (object.number) or
            object.type == 'in_refund' and object.state == 'draft' and 'Intrastat Vendor Credit Note' or
            object.type == 'in_refund' and 'Intrastat Vendor Credit Note - %s' % (object.number))"
    />
</odoo>